<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>リパライン語単語分解</title>
<style>
@font-face {
    font-family: "Cirlipa";
    src: url("./cirlxarli_liparxe_1.woff");  format('woff');
}
textarea{
    font-family: "Cirlipa"; font-size:300%;
}


.nolipa { font-family:"Arial"; }

body{width:70%; margin: 0 auto;}
#main{font-size:120%; margin: 30px;}
</style>
<script src="decompose.js"></script>
<script src="decompose_gui.js"></script>
<script src="w.js"></script>
</head>
<body>
<div id="main">
単語を入力：<input type="text" id="word" value="dytyleter"/><input type="button" onclick="gui(document.getElementById('word').value)" value="分解">
<div id="ans"></div>
</div>
<hr>
<div class="log">
<h3>開発ログ</h3>
<h4>1. 準備</h4>
<p>使用する単語リストは、リパライン語OTM-JSONから頭字語などを取り除いた<a href="https://github.com/sozysozbot/akrantiain2/blob/master/samples/input_sample/input_sample_lineparine_renewed.txt">この</a>ファイルから、ピリオドやスペースの入った人名や略号など（la+単語として登録されていたものを含む）などを除いた<a href="words.txt">ファイル</a>。6557項目が登録されている。</p>
<p>さて、実はリパライン語には「<a href="https://fafss.slack.com/archives/C7DC7976K/p1506990956000054">単語と単語がくっ付くときは-r-でしかないのと、-r-はそこまで頻繁に使われないから大半の単語の語幹は一意に決められる</a>」という特性がある。登録されている項目をハイフンの位置により「独立単語」「前置辞」「語中辞」「語尾辞」に分類すれば、独立語と独立語の間には-r-が入るということである。</p>
<p>要するに、「どちらかの側にはハイフンが入っている」という原則と考えれば良い。例を挙げれば、<code>dytyleter</code>は<code>dyty-</code>, <code>-l-</code>, <code>et</code>, <code>-er</code>と分解されるが、このとき項目と項目の間には1つ以上のハイフンが入っている。</p>
<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">とりあえず素朴な実装をして、「いや、この分解はありえない」とかを指摘してもらった方がいいか</p>&mdash; .sozysozbot.@hsjoihs (@sosoBOTpi) <a href="https://twitter.com/sosoBOTpi/status/923338213392969729?ref_src=twsrc%5Etfw">2017年10月25日</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>とりあえず、文法的な考察をする前に、この条件だけで全探索するプログラムを書いてみるか。やってくうちに追加条件が出てくるでしょう</p>
<h4>2. 軽く実装</h4>
<p>とりあえず、ハイフンの有無で4ファイルに分離。</p>
<p>規則も記述してJSONにする。</p>
<p>実装できた。</p>
<img src="demo.png" width="500"/>

<h4>3. 改良</h4>
<p>いくつか情報が来たので、それを元に改良する。</p>
<p>まず「語中辞は後方に形態素を要求するが、独立単語(語根)を直接繋げられるのは-r-と-rapt-のみである。-inie-は数詞のみ、その他緩衝音類は後方には接辞を要求する。」とのこと。これに基づいて規則を改定する。</p>
<p>現状の規則はこんな感じ。</p>
<pre>
[
	["INITIAL","q"],
	["INITIAL","q-"],

	["q","-q"],
	["q","-q-"],

	["q-","q"],
	["q-","q-"],
	["q-","-q"],
	["q-","-q-"],

	["-q","-q"],
	["-q","-q-"],

	["-q-","q"],
	["-q-","q-"],
	["-q-","-q"],
	["-q-","-q-"],

	["q","FINAL"],
	["-q","FINAL"]
]
</pre>
<p>語中辞を"-q-"と"-r-"に分離して…っと、待てよ。「緩衝音類は後方には接辞を要求する。」にしてしまうとdytyleterが通らないな。「前に来てるのが接辞なら後ろは単語でもいい」のかと聞いてみたところ、『「緩衝音類は前後のいずれかに接辞を要求する」かなあ』とのこと。</p>
<p>さて、これをどう落とし込むかだが、まあ「同一の-q-を2種類立てる」が一時しのぎとしては有効かな。</p>
<p>これをやると重複が発生するので、重複を消去。</p>
<p>いや、うまくやれば解決できるか。「qに後続した場合だけ-q1-、それ以外は-q2-のみ」でいい。</p>
<p>よし重複解決。</p>
<p>しかし["la","-axm","-el","-e-","n"]は弾かれない。これを弾くなら、「緩衝音類は、前に接頭辞が来るか後ろに接尾辞が来るかの2択だ」と定式化すべきだな。</p><p>「la-stan-a-'sみたいなことはあるので前後同時に接辞が来ることもある（まあ、弾くわけではないからこれも含むか）」と言われた。まあそうよね。</p>
<p>とりあえず実装できた。</p>

<h4>4. さらに改良</h4>
<p>ff「特別警察」が辞書に紛れ込んでいたので削除。</p>
<p>-tは格語尾（「基本的に-'s, -'i, -'cにしかつかないが、-'lt, -'scitの形とかもあるかもしれない」とのこと）とか分離標識とか複代副詞とかにしかつかないらしい。そして必ず語末である。</p>
<p>とりあえず、「必ず語末」「接頭辞・語中辞の後には来ない」が言えるので実装する。</p>
<p>実装した。</p>
<p>「緩衝音が連続することは無い」と言われた。実装した。["dyty-","-l-","et","-er"], ["pask-","-effe","-snej"], ["la","-axm","-el","-en"]が完璧に分解され、「緩衝音が連続しないことは重要だったんやな……」「雰囲気で読んでるからほんとこういう実装をする時に本質が見えてくるのすこ」となった。よきかな。</p>
</div>
</body>
</html>
